{% load i18n %}
{% load static %}
{% load django_vite %}
{% load django_htmx %}

<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KrisPC{% endblock %}</title>

    <!-- Google Fonts: Inter & Lobster -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lobster&display=swap"
        rel="stylesheet">

    <!-- Vite Assets (Tailwind & JS) -->
    {% vite_hmr_client %}
    {% vite_asset 'main.js' %}

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
    {% django_htmx_script %}

    {% block extra_head %}{% endblock %}
</head>

<body class="bg-gray-50 text-gray-900 font-sans antialiased" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
    data-theme-version="v2">

    <!-- Global Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- Brand -->
                <div class="flex items-center">
                    <a href="{% url 'hub:index' %}"
                        class="font-brand text-3xl text-primary hover:text-primary-dark transition-colors">
                        KrisPC
                    </a>
                </div>

                <!-- Main Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="https://hub.krispc.fr"
                        class="text-sm font-medium text-gray-700 hover:text-primary transition-colors">Hub</a>
                    <a href="https://com.krispc.fr"
                        class="text-sm font-medium text-gray-700 hover:text-primary transition-colors">KrisPC</a>
                    <a href="https://plexus.krispc.fr"
                        class="text-sm font-medium text-gray-700 hover:text-primary transition-colors">Plexus</a>
                    <a href="https://p2c.krispc.fr"
                        class="text-sm font-medium text-gray-700 hover:text-primary transition-colors">Pdf2Cal</a>
                </nav>

                <!-- Right Side: User & Lang -->
                <div class="flex items-center space-x-4">
                    {% if user.is_authenticated %}
                    <span class="text-xs text-gray-500 hidden sm:inline">{{ user.username }}</span>
                    <form action="{% url 'logout' %}" method="post" class="inline">
                        {% csrf_token %}
                        <button type="submit"
                            class="text-xs font-semibold text-gray-600 hover:text-red-600 transition-colors">
                            {% trans "Logout" %}
                        </button>
                    </form>
                    {% else %}
                    <a href="{% url 'login' %}" class="text-sm font-semibold text-primary hover:text-primary-dark">
                        {% trans "Login" %}
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <!-- Sub Navigation -->
    {% block sub_nav %}{% endblock %}

    <!-- Main Content -->
    <main class="min-h-screen">
        {% block content %}{% endblock %}
    </main>

    <!-- Global Footer -->
    <footer class="bg-white border-t border-gray-200 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <div class="font-brand text-2xl text-gray-400">
                    KrisPC
                </div>
                <nav class="flex space-x-6 text-sm text-gray-500">
                    <a href="{% url 'hub:privacy' %}" class="hover:text-primary transition-colors">{% trans "Privacy"
                        %}</a>
                    <a href="{% url 'hub:terms' %}" class="hover:text-primary transition-colors">{% trans "Terms" %}</a>
                    <span>&copy; 2026</span>
                </nav>
                <div class="flex space-x-4">
                    <form action="{% url 'hub:switch_language' %}" method="post">
                        {% csrf_token %}
                        <input name="next" type="hidden" value="{{ request.path }}">
                        <button type="submit" name="language" value="fr"
                            class="text-xs {% if LANGUAGE_CODE == 'fr' %}font-bold text-primary{% else %}text-gray-400{% endif %} hover:text-primary transition-colors">
                            FR
                        </button>
                    </form>
                    <span class="text-gray-300">|</span>
                    <form action="{% url 'hub:switch_language' %}" method="post">
                        {% csrf_token %}
                        <input name="next" type="hidden" value="{{ request.path }}">
                        <button type="submit" name="language" value="en"
                            class="text-xs {% if LANGUAGE_CODE == 'en' %}font-bold text-primary{% else %}text-gray-400{% endif %} hover:text-primary transition-colors">
                            EN
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </footer>

    {% block extra_js %}{% endblock %}

    <!-- Global Analytics -->
    <script src="{% static 'analytics/tracker.js' %}" defer></script>
</body>

</html>